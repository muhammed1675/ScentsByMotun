<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Shopping Cart - ScentsBymotun" />
    <title>Shopping Cart - ScentsBymotun</title>
    <link rel="stylesheet" href="../css/style.css" />
    <script src="https://js.paystack.co/v1/inline.js"></script>
  </head>
  <body>
    <!-- Header & Navigation -->
    <header>
      <div class="container">
        <nav class="flex justify-between items-center">
          <a href="../index.html" class="logo">ScentsBymotun</a>

          <ul class="nav-menu">
            <li><a href="../index.html">Home</a></li>
            <li><a href="shop.html">Shop</a></li>
            <li><a href="../index.html#contact">Contact</a></li>
          </ul>

          <div class="nav-actions">
            <a href="cart.html" class="cart-icon" title="Shopping Cart">
              üõçÔ∏è
              <span class="cart-count" id="cart-count" style="display: none">0</span>
            </a>
            <button class="user-icon" id="user-menu-btn" title="Account">üë§</button>
          </div>
        </nav>
      </div>
    </header>

    <!-- User Menu -->
    <div id="user-menu" class="modal">
      <div class="modal-content" style="max-width: 300px">
        <div class="modal-header">
          <h3 class="modal-title">Account</h3>
          <button class="modal-close" onclick="closeUserMenu()">‚úï</button>
        </div>
        <div id="auth-menu"></div>
      </div>
    </div>

    <!-- Main Content -->
    <main>
      <!-- Breadcrumbs -->
      <section style="background-color: var(--bg-secondary); padding: 1rem 0">
        <div class="container">
          <div class="breadcrumbs">
            <a href="../index.html">Home</a>
            <span>/</span>
            <span>Cart</span>
          </div>
        </div>
      </section>

      <!-- Cart Section -->
      <section>
        <div class="container">
          <h1>Shopping Cart</h1>

          <!-- Empty Cart Message -->
          <div id="empty-cart" style="text-align: center; padding: 3rem">
            <p style="margin-bottom: 1rem">Your cart is empty</p>
            <a href="shop.html" class="btn btn-primary">Continue Shopping</a>
          </div>

          <!-- Cart Items -->
          <div id="cart-content" style="display: none">
            <div class="grid grid-cols-3 gap-4">
              <!-- Cart Items Column -->
              <div style="grid-column: 1 / 3">
                <div id="cart-items" style="margin-bottom: 2rem">
                  <!-- Items will be rendered here -->
                </div>
              </div>

              <!-- Cart Summary Column -->
              <div>
                <div class="card p-4" style="position: sticky; top: 100px">
                  <h3 style="margin-bottom: 1.5rem">Order Summary</h3>

                  <div style="display: flex; justify-content: space-between; margin-bottom: 1rem">
                    <span>Subtotal:</span>
                    <span id="subtotal">‚Ç¶0</span>
                  </div>

                  <div style="display: flex; justify-content: space-between; margin-bottom: 1rem">
                    <span>Shipping:</span>
                    <span id="shipping">‚Ç¶0</span>
                  </div>

                  <div
                    style="border-top: 1px solid var(--border-color); padding-top: 1rem; display: flex; justify-content: space-between; margin-bottom: 1.5rem"
                  >
                    <strong>Total:</strong>
                    <strong id="total" style="color: var(--secondary); font-size: 1.25rem">‚Ç¶0</strong>
                  </div>

                  <button class="btn btn-gold btn-block btn-lg mb-2" onclick="goToCheckout()">
                    Proceed to Checkout
                  </button>
                  <a href="shop.html" class="btn btn-secondary btn-block">Continue Shopping</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h4>ScentsBymotun</h4>
            <p>Premium luxury fragrances for the discerning individual.</p>
          </div>

          <div class="footer-section">
            <h4>Quick Links</h4>
            <a href="shop.html">Shop</a>
            <a href="#about">About Us</a>
            <a href="#returns">Returns</a>
          </div>

          <div class="footer-section">
            <h4>Customer Service</h4>
            <a href="mailto:support@scentsbymotun.com">Email Support</a>
            <a href="tel:+2341234567890">Call Us</a>
            <a href="#faq">FAQ</a>
          </div>

          <div class="footer-section">
            <h4>Follow Us</h4>
            <div class="social-links">
              <a href="https://instagram.com/scentsbymotun" target="_blank" title="Instagram">üì∑</a>
              <a href="https://twitter.com/scentsbymotun" target="_blank" title="Twitter">ùïè</a>
              <a href="https://facebook.com/scentsbymotun" target="_blank" title="Facebook">f</a>
            </div>
          </div>
        </div>

        <div class="footer-bottom">
          <p>&copy; 2024 ScentsBymotun. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <!-- Scripts -->
    <script type="module">
      import { cart } from '../js/cart.js';
      import { auth } from '../js/auth.js';

      // [v0] Initialize cart page
      console.log('[v0] Cart page initializing');

      const SHIPPING_THRESHOLD = 50000;
      const SHIPPING_COST = 2500;

      // Display cart
      function displayCart() {
        const cartItems = cart.getCart();

        if (cartItems.length === 0) {
          document.getElementById('empty-cart').style.display = 'block';
          document.getElementById('cart-content').style.display = 'none';
          return;
        }

        document.getElementById('empty-cart').style.display = 'none';
        document.getElementById('cart-content').style.display = 'block';

        // Render items
        const itemsHTML = cartItems
          .map(
            (item) => `
          <div class="card p-4 mb-3">
            <div class="grid grid-cols-4 gap-4">
              <img src="${item.image_url}" alt="${item.name}" style="width: 100%; height: 150px; object-fit: cover; border-radius: var(--radius-md)" onerror="this.src='https://via.placeholder.com/150?text=${encodeURIComponent(item.name)}'">
              
              <div class="flex flex-col justify-between">
                <div>
                  <h4 class="mb-2">${item.name}</h4>
                  <p style="color: var(--secondary); font-weight: 600">‚Ç¶${item.price.toLocaleString()}</p>
                </div>
              </div>

              <div class="flex flex-col justify-between items-start">
                <label>Quantity</label>
                <div class="flex gap-1">
                  <button class="btn btn-sm btn-secondary" onclick="updateQuantity('${item.id}', ${item.quantity - 1})">‚àí</button>
                  <input type="number" value="${item.quantity}" style="width: 50px; text-align: center" readonly>
                  <button class="btn btn-sm btn-secondary" onclick="updateQuantity('${item.id}', ${item.quantity + 1})">+</button>
                </div>
              </div>

              <div class="flex flex-col justify-between items-end">
                <p style="color: var(--text-secondary)">‚Ç¶${(item.price * item.quantity).toLocaleString()}</p>
                <button class="btn btn-sm btn-secondary" onclick="removeFromCart('${item.id}')">Remove</button>
              </div>
            </div>
          </div>
        `
          )
          .join('');

        document.getElementById('cart-items').innerHTML = itemsHTML;

        // Update summary
        updateOrderSummary();
      }

      // Update order summary
      function updateOrderSummary() {
        const subtotal = cart.getCartTotal();
        const shipping = subtotal >= SHIPPING_THRESHOLD ? 0 : SHIPPING_COST;
        const total = subtotal + shipping;

        document.getElementById('subtotal').textContent = '‚Ç¶' + subtotal.toLocaleString();
        document.getElementById('shipping').textContent = shipping === 0 ? 'FREE' : '‚Ç¶' + shipping.toLocaleString();
        document.getElementById('total').textContent = '‚Ç¶' + total.toLocaleString();
      }

      // Update quantity
      window.updateQuantity = (productId, newQuantity) => {
        if (newQuantity <= 0) {
          removeFromCart(productId);
        } else {
          cart.updateQuantity(productId, newQuantity);
          displayCart();
        }
      };

      // Remove from cart
      window.removeFromCart = (productId) => {
        cart.removeFromCart(productId);
        displayCart();
        updateCartCount();
      };

      // Go to checkout
      window.goToCheckout = () => {
        if (!auth.isAuthenticated()) {
          alert('Please login to proceed with checkout');
          window.location.href = 'login.html';
        } else {
          window.location.href = 'checkout.html';
        }
      };

      // Update cart count
      function updateCartCount() {
        const count = cart.getCartCount();
        const badge = document.getElementById('cart-count');
        if (count > 0) {
          badge.textContent = count;
          badge.style.display = 'flex';
        } else {
          badge.style.display = 'none';
        }
      }

      // Update auth menu
      function updateAuthMenu() {
        const menu = document.getElementById('auth-menu');
        if (auth.isAuthenticated()) {
          menu.innerHTML = `
            <p style="margin-bottom: var(--spacing-md)">Welcome, <strong>${auth.getUser().email}</strong></p>
            <button class="btn btn-primary btn-block mb-2" onclick="logout()">Logout</button>
          `;
        } else {
          menu.innerHTML = `
            <button class="btn btn-primary btn-block mb-2" onclick="goToLogin()">Login</button>
            <button class="btn btn-secondary btn-block" onclick="goToSignup()">Sign Up</button>
          `;
        }
      }

      // Global functions
      window.goToLogin = () => {
        window.location.href = 'login.html';
      };

      window.goToSignup = () => {
        window.location.href = 'signup.html';
      };

      window.logout = async () => {
        await auth.signOut();
        window.location.href = 'cart.html';
      };

      window.closeUserMenu = () => {
        document.getElementById('user-menu').classList.remove('active');
      };

      // Event listeners
      document.getElementById('user-menu-btn').addEventListener('click', () => {
        document.getElementById('user-menu').classList.add('active');
      });

      document.getElementById('user-menu').addEventListener('click', (e) => {
        if (e.target.id === 'user-menu') {
          closeUserMenu();
        }
      });

      window.addEventListener('cart_updated', () => {
        displayCart();
        updateCartCount();
      });

      // Initialize
      displayCart();
      updateCartCount();
      updateAuthMenu();
    </script>
  </body>
</html>
